<!DOCTYPE html>
<html>
    <head>
        <meta charset=utf-8 />
        <title></title>
        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <script src='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.js'></script>
        <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
        <script src='https://code.jquery.com/jquery-1.11.0.min.js'></script>
        <link href='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.css' rel='stylesheet' />
        <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
        <style>
         body { margin:0; padding:0; }
         #map { position:absolute; top:0; bottom:0; width:100%; }
         .popup {
             text-align:center;
         }
         .popup .slideshow .image        { display:none; }
         .popup .slideshow .image.active { display:block; }
         .popup .slideshow img {
             width:100%;
         }
        </style>
    </head>
    <body>
        <div id='map'></div>
        <script>
         L.mapbox.accessToken = 'pk.eyJ1IjoibWF4bW91Y2hldCIsImEiOiJjaWs5eXIxejEwMDFkd2FseW9hcXUyNWw0In0.pRpEBdyR_cGI-A3i9Ldtkw';
         var map = L.mapbox.map('map', 'maxmouchet.p95cp2bi');
         L.control.fullscreen().addTo(map);

         map.featureLayer.on('layeradd', function(e) {
             var marker = e.layer;
             var feature = marker.feature;
             var images = feature.properties.images
             var slideshowContent = '';

             if (images == null) {
                 images = [feature.properties.title];
                 console.log(feature.properties.title);
                 feature.properties.title = "";
             }

             for(var i = 0; i < images.length; i++) {
                 var img = images[i];

                 slideshowContent += '<div class="image' + (i === 0 ? ' active' : '') + '">' +
                                     '<img src="' + img + '" />' +
                                     '</div>';
             }

             var popupContent =  '<div id="' + feature.properties.id + '" class="popup">' +
                                 '<h2>' + feature.properties.title + '</h2>' +
                                 '<div class="slideshow">' +
                                 slideshowContent +
                                 '</div>' +
                                 '</div>';

             // http://leafletjs.com/reference.html#popup
             marker.bindPopup(popupContent,{
                 closeButton: false,
                 minWidth: 700,
                 autoPan: false
             });

             // Failover
             /* marker.on('mouseover', function (e) { */
             /* this.openPopup(); */
             /* }); */
         });

         $.getJSON('features.json', function(json) {
             map.featureLayer.setGeoJSON(json);
         });

         map.featureLayer.on('click', function(e) {
             map.setZoom(12);
             console.log(e.layer.getLatLng());
             latLng = e.layer.getLatLng();
             map.panTo({lat: latLng.lat+0.05, lng: latLng.lng});
         });

         // Failover
         /* map.featureLayer.on('mouseover', function(e) { */
         /* map.setZoom(12); */
         /* console.log(e.layer.getLatLng()); */
         /* latLng = e.layer.getLatLng(); */
         /* map.panTo({lat: latLng.lat+0.05, lng: latLng.lng}); */
         /* }); */

         map.on('click', function(e) {
             map.setView([48.85341-10, 5], 3);
         });

         map.setView([48.85341-10, 5], 3);
        </script>
    </body>
</html>
